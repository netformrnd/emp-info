<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NETFORM R&D - ì§ì› ì •ë³´ ì œì¶œ</title>
<link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" rel="stylesheet">
<style>
:root{--bg:#f5f5f5;--surface:#ffffff;--surface-2:#fafafa;--border:#e5e5e5;--accent:#0f172a;--accent-blue:#1d4ed8;--accent-light:#eff6ff;--text:#171717;--sub:#737373;--dim:#a3a3a3;--green:#15803d;--green-light:#f0fdf4;--orange:#c2410c;--orange-light:#fff7ed;--red:#b91c1c;--radius:8px;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Pretendard Variable',Pretendard,-apple-system,BlinkMacSystemFont,'Segoe UI','Malgun Gothic',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;font-size:15.5px;-webkit-font-smoothing:antialiased;}

/* ===== í—¤ë” ===== */
.header{background:var(--accent);padding:0 32px;height:56px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;}
.header-logo{display:flex;align-items:center;gap:12px;}
.logo-divider{width:1px;height:20px;background:rgba(255,255,255,.2);}
.logo-company{font-size:15px;font-weight:700;color:#fff;letter-spacing:.5px;}
.logo-page{font-size:14px;color:rgba(255,255,255,.6);font-weight:400;}
.header-deadline{color:rgba(255,255,255,.8);font-size:13px;font-weight:500;display:flex;align-items:center;gap:6px;}
.header-deadline .dot{width:6px;height:6px;border-radius:50%;background:#f59e0b;animation:pulse 2s ease infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

.wrap{max-width:840px;margin:0 auto;padding:0 22px;}

/* ===== ì„œë¸Œ í—¤ë” ===== */
.sub-header{background:var(--surface);border-bottom:1px solid var(--border);padding:24px 20px;margin:0 -20px;}
.sub-header h1{font-size:22px;font-weight:800;letter-spacing:-.5px;margin-bottom:6px;}
.sub-header p{font-size:15px;color:var(--sub);line-height:1.6;}
.sub-header-meta{display:flex;gap:20px;margin-top:14px;flex-wrap:wrap;}
.meta-item{font-size:13px;color:var(--sub);display:flex;align-items:center;gap:4px;}
.meta-item b{color:var(--text);}
.meta-item .tag{padding:2px 8px;background:var(--accent);color:#fff;border-radius:4px;font-weight:700;font-size:11px;}

/* ===== ì•ˆë‚´ ì„¹ì…˜ ===== */
.info-section{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);margin:24px 0;overflow:hidden;}
.info-header{padding:16px 20px;background:var(--surface-2);border-bottom:1px solid var(--border);font-size:14px;font-weight:700;color:var(--sub);text-transform:uppercase;letter-spacing:1px;cursor:pointer;display:flex;align-items:center;justify-content:space-between;list-style:none;}
.info-header::-webkit-details-marker{display:none;}
.info-header::after{content:'â–¾';font-size:11px;transition:.2s;}
.info-section[open] .info-header::after{transform:rotate(180deg);}
.info-body{padding:20px;}
.info-row{display:flex;gap:16px;margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid var(--border);}
.info-row:last-child{margin-bottom:0;padding-bottom:0;border-bottom:none;}
.info-num{width:28px;height:28px;background:var(--accent);color:#fff;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0;margin-top:2px;}
.info-text{flex:1;}
.info-title{font-size:15px;font-weight:700;margin-bottom:6px;}
.info-desc{font-size:14px;color:var(--sub);line-height:1.7;}
.info-desc b{color:var(--text);}
.info-box{margin-top:10px;padding:14px 18px;border-radius:6px;font-size:14px;line-height:1.7;}
.info-box.example{background:var(--accent-light);border-left:3px solid var(--accent-blue);}
.info-box.warning{background:var(--orange-light);border-left:3px solid var(--orange);}
.info-video-section{background:var(--surface-2);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin:0 0 16px;}
.info-video-label{font-size:14px;font-weight:700;color:var(--text);margin-bottom:10px;display:flex;align-items:center;gap:6px;}
.info-video{border-radius:var(--radius);overflow:hidden;border:1px solid var(--border);box-shadow:0 2px 8px rgba(0,0,0,.06);cursor:pointer;position:relative;}
.info-video:hover{border-color:var(--accent);box-shadow:0 2px 12px rgba(0,0,0,.12);}
.info-video video{width:100%;display:block;}
.info-video-hint{text-align:center;font-size:11px;color:var(--dim);margin-top:8px;}
.video-modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.85);z-index:600;align-items:center;justify-content:center;cursor:pointer;}
.video-modal-overlay.show{display:flex;}
.video-modal-overlay video{max-width:92vw;max-height:88vh;border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,.5);}
.video-modal-close{position:fixed;top:16px;right:20px;background:rgba(255,255,255,.15);border:none;color:#fff;font-size:28px;cursor:pointer;width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;z-index:601;transition:.15s;}
.video-modal-close:hover{background:rgba(255,255,255,.3);}
.info-preview{margin-top:16px;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;background:var(--surface-2);}
.info-preview summary{padding:10px 14px;font-size:12px;font-weight:600;color:var(--sub);background:var(--surface-2);cursor:pointer;display:flex;align-items:center;gap:6px;list-style:none;user-select:none;}
.info-preview summary::-webkit-details-marker{display:none;}
.info-preview summary::after{content:'â–¸';font-size:10px;margin-left:auto;transition:.2s;}
.info-preview[open] summary::after{transform:rotate(90deg);}
.info-preview[open] summary{border-bottom:1px solid var(--border);}
.info-preview-img{position:relative;max-width:320px;margin:16px auto;padding:0 16px 16px;}
.info-preview-img img{width:100%;display:block;border-radius:6px;box-shadow:0 2px 12px rgba(0,0,0,.08);}
.info-hl{position:absolute;border:2.5px solid rgba(29,78,216,.85);border-radius:6px;pointer-events:none;animation:hlBlink 1.5s ease-in-out infinite;}
.info-hl-tag{position:absolute;top:-10px;right:6px;background:var(--accent-blue);color:#fff;font-size:8px;font-weight:700;padding:2px 6px;border-radius:3px;letter-spacing:.5px;white-space:nowrap;}
@keyframes hlBlink{0%,100%{opacity:1;border-color:rgba(29,78,216,.9);box-shadow:0 0 8px rgba(29,78,216,.4)}50%{opacity:.3;border-color:rgba(29,78,216,.2);box-shadow:0 0 0 rgba(29,78,216,0)}}

/* ===== íƒ­ ===== */
.tabs{display:flex;border-bottom:2px solid var(--border);margin:24px 0 0;gap:0;}
.tab{padding:16px 24px;font-size:15px;font-weight:600;cursor:pointer;border:none;background:none;color:var(--sub);border-bottom:2px solid transparent;margin-bottom:-2px;transition:.15s;display:flex;align-items:center;gap:8px;font-family:inherit;}
.tab:hover{color:var(--text);}
.tab.on{color:var(--accent);border-bottom-color:var(--accent);}

/* ===== ì¹´ë“œ ===== */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:16px;overflow:hidden;}
.card-header{padding:18px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;background:var(--surface-2);}
.card-icon{width:32px;height:32px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:16px;background:var(--accent);color:#fff;}
.card-title{font-size:14px;font-weight:700;}
.card-sub{font-size:12px;color:var(--sub);}
.card-body{padding:20px;}

/* í¼ */
.form-group{margin-bottom:16px;}
.form-label{font-size:11px;font-weight:700;color:var(--sub);display:block;margin-bottom:6px;text-transform:uppercase;letter-spacing:1px;}
.form-select,.form-input{width:100%;padding:11px 14px;border:1px solid var(--border);border-radius:6px;font-size:14px;outline:none;background:var(--surface);color:var(--text);transition:.15s;font-family:inherit;}
.form-select:focus,.form-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(15,23,42,.06);}

/* ===== íŒ€ì› ì¹´ë“œ ===== */
.member{border:1px solid var(--border);border-radius:var(--radius);margin-bottom:8px;overflow:hidden;}
.member.is-lead{border-color:var(--accent);}
.member-head{display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--surface-2);border-bottom:1px solid var(--border);}
.member.is-lead .member-head{background:var(--accent);color:#fff;}
.member-av{width:36px;height:36px;border-radius:6px;background:var(--accent);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:#fff;flex-shrink:0;}
.member.is-lead .member-av{background:rgba(255,255,255,.2);}
.member-info{flex:1;}
.member-nm{font-size:15px;font-weight:700;display:flex;align-items:center;gap:8px;}
.member-pos{font-size:13px;color:var(--sub);margin-top:1px;}
.member.is-lead .member-pos{color:rgba(255,255,255,.7);}
.member-badge{font-size:10px;font-weight:700;color:var(--accent);background:rgba(255,255,255,.9);padding:2px 8px;border-radius:4px;}
.member-body{padding:14px 16px;}

.task-section-label{font-size:11px;font-weight:700;color:var(--sub);margin-bottom:4px;display:flex;align-items:center;gap:6px;}
.task-section-label .tsl-badge{font-size:9px;font-weight:700;padding:2px 6px;border-radius:3px;color:#fff;}
.tsl-badge.primary{background:var(--accent);}
.tsl-badge.secondary{background:var(--sub);}
.task-rows{display:flex;flex-direction:column;gap:6px;}
.task-row{display:flex;align-items:center;gap:6px;}
.task-input{padding:10px 13px;border:1px solid var(--border);border-radius:6px;font-size:13.5px;outline:none;flex:1;transition:.15s;font-family:inherit;}
.task-input:focus{border-color:var(--accent);box-shadow:0 0 0 2px rgba(15,23,42,.06);}
.task-input.primary-task{border-left:3px solid var(--accent);}
.btn-del-task{width:26px;height:26px;border:1px solid var(--border);background:var(--surface);color:var(--dim);font-size:14px;cursor:pointer;border-radius:4px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:.12s;}
.btn-del-task:hover{color:var(--red);border-color:var(--red);background:rgba(185,28,28,.04);}
.btn-add-task{margin-top:6px;padding:7px 14px;background:var(--surface);border:1px dashed var(--border);border-radius:6px;color:var(--sub);font-size:12px;cursor:pointer;transition:.15s;font-family:inherit;font-weight:500;}
.btn-add-task:hover{border-color:var(--accent);color:var(--accent);}
.task-divider{height:1px;background:var(--border);margin:10px 0 8px;}

/* ===== ì‚¬ì§„ í˜„í™© ===== */
.stat-bar{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:var(--border);border-radius:var(--radius);overflow:hidden;margin-bottom:12px;}
.stat-item{padding:10px 12px;text-align:center;background:var(--surface);}
.stat-label{font-size:10px;font-weight:600;color:var(--sub);text-transform:uppercase;letter-spacing:.5px;}
.stat-n{font-size:20px;font-weight:800;display:block;margin-top:2px;}
.stat-total .stat-n{color:var(--accent);}
.stat-done .stat-n{color:var(--green);}
.stat-remain .stat-n{color:var(--orange);}
.progress-wrap{display:flex;align-items:center;gap:10px;margin-bottom:14px;}
.progress-bar{flex:1;height:4px;background:var(--border);border-radius:2px;overflow:hidden;}
.progress-bar .fill{height:100%;background:var(--green);border-radius:2px;transition:width .4s ease;}
.progress-pct{font-size:12px;font-weight:700;color:var(--green);}

/* ì‚¬ì§„ ëª©ë¡ */
.search-input{width:100%;padding:11px 14px;border:1px solid var(--border);border-radius:6px;font-size:14px;outline:none;font-family:inherit;transition:.15s;}
.search-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(15,23,42,.06);}
.search-input::placeholder{color:var(--dim);}
.person-list{margin-top:10px;height:360px;overflow-y:auto;}
.person-item{display:flex;align-items:center;gap:12px;padding:12px 14px;border:1px solid var(--border);border-radius:6px;margin-bottom:6px;cursor:pointer;transition:.12s;}
.person-item:hover{background:var(--surface-2);border-color:var(--accent);}
.person-item.on{background:var(--green-light);border-color:var(--green);}
.person-item .p-av{width:32px;height:32px;border-radius:6px;background:var(--accent);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff;flex-shrink:0;}
.person-item .p-nm{font-weight:600;font-size:13px;}
.person-item .p-info{font-size:11px;color:var(--sub);}
.done-badge{display:inline-flex;align-items:center;gap:4px;background:var(--green-light);color:var(--green);padding:4px 10px;border-radius:4px;font-size:11px;font-weight:700;margin-left:auto;text-transform:uppercase;letter-spacing:.3px;}
.undone-badge{display:inline-flex;align-items:center;gap:4px;background:var(--orange-light);color:var(--orange);padding:4px 10px;border-radius:4px;font-size:11px;font-weight:700;margin-left:auto;}

/* ===== ì‚¬ì§„ ëª¨ë‹¬ ===== */
.modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:500;align-items:center;justify-content:center;}
.modal-overlay.show{display:flex;}
.modal{background:var(--surface);border-radius:12px;padding:32px;max-width:400px;width:90%;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.25);position:relative;animation:modalIn .2s ease;}
@keyframes modalIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.modal-close{position:absolute;top:12px;right:14px;background:none;border:none;font-size:20px;cursor:pointer;color:var(--dim);line-height:1;}
.modal-close:hover{color:var(--text);}
.modal .photo-circle{width:140px;height:140px;border-radius:12px;border:2px dashed var(--border);display:flex;align-items:center;justify-content:center;overflow:hidden;cursor:pointer;transition:.15s;background:var(--surface-2);margin:0 auto 16px;}
.modal .photo-circle:hover{border-color:var(--accent);}
.modal .photo-circle.has-photo{border-style:solid;border-color:var(--green);}
.modal .photo-circle img{width:100%;height:100%;object-fit:cover;}
.modal .photo-circle svg{width:40px;height:40px;color:var(--dim);}
.modal-name{font-size:18px;font-weight:700;margin-bottom:4px;}
.modal-sub{font-size:12px;color:var(--sub);margin-bottom:18px;}
.modal-btns{display:flex;gap:8px;justify-content:center;margin-top:16px;}

/* ===== ê´€ë¦¬ì ===== */
.admin-area{margin-top:20px;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;}
.admin-area summary{padding:14px 20px;font-size:13px;font-weight:600;color:var(--sub);cursor:pointer;background:var(--surface-2);border-bottom:1px solid var(--border);list-style:none;display:flex;align-items:center;gap:6px;}
.admin-area summary::-webkit-details-marker{display:none;}
.admin-area summary:hover{color:var(--accent);}
.admin-area[open] summary{border-bottom:1px solid var(--border);}
.admin-inner{padding:20px;}
.admin-lock{display:flex;align-items:center;gap:8px;}
.admin-lock input{width:120px;padding:8px 12px;border:1px solid var(--border);border-radius:6px;font-size:13px;outline:none;text-align:center;letter-spacing:2px;font-family:inherit;}
.admin-lock input:focus{border-color:var(--accent);}
.admin-lock .lock-msg{font-size:12px;color:var(--red);margin-left:4px;}
.admin-content{display:none;}
.admin-section-title{font-size:12px;font-weight:700;color:var(--sub);margin:16px 0 8px;text-transform:uppercase;letter-spacing:.5px;display:flex;align-items:center;gap:6px;}
.admin-section-title:first-child{margin-top:0;}
.admin-btns{display:flex;gap:8px;flex-wrap:wrap;}

/* ===== ë²„íŠ¼ ===== */
.btn{padding:10px 22px;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;border:1px solid var(--border);background:var(--surface);color:var(--text);transition:.15s;font-family:inherit;display:inline-flex;align-items:center;gap:6px;}
.btn:hover{background:var(--surface-2);}
.btn-p{background:var(--accent);color:#fff;border-color:var(--accent);}
.btn-p:hover{background:#1e293b;}
.btn-g{background:var(--green);color:#fff;border-color:var(--green);}
.btn-g:hover{background:#166534;}
.btn-sm{padding:8px 16px;font-size:12px;}
.btn-d{border-color:var(--red);color:var(--red);}.btn-d:hover{background:rgba(185,28,28,.04);}
.actions{display:flex;gap:8px;justify-content:center;margin-top:24px;}

.panel{display:none;}.panel.on{display:block;}
.tab-content{padding:24px 0;}
.save-status{text-align:center;margin-top:12px;font-size:13px;color:var(--green);font-weight:600;display:none;}
.empty-msg{text-align:center;padding:40px;color:var(--dim);font-size:14px;}

/* í† ìŠ¤íŠ¸ */
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--accent);color:#fff;padding:12px 28px;border-radius:8px;font-size:13px;font-weight:500;opacity:0;transition:.3s;z-index:999;pointer-events:none;box-shadow:0 8px 24px rgba(0,0,0,.15);}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
.toast.ok{background:var(--green);}.toast.err{background:var(--red);}

.footer{border-top:1px solid var(--border);margin-top:40px;padding:20px 0;display:flex;align-items:center;justify-content:space-between;font-size:12px;color:var(--dim);}
</style>
</head>
<body>

<div class="header">
    <div class="header-logo">
        <span class="logo-company">NETFORM R&D</span>
        <span class="logo-divider"></span>
        <span class="logo-page">ì§ì› ì •ë³´ ì‹œìŠ¤í…œ</span>
    </div>
    <div class="header-deadline"><span class="dot"></span> ë§ˆê° 2/19(ëª©)</div>
</div>

<div class="wrap">
    <div class="sub-header">
        <h1>ğŸ“¢ ì„ì§ì› ì—…ë¬´Â·í”„ë¡œí•„ ë“±ë¡ ìš”ì²­</h1>
        <p>ì„ì§ì› ì •ë³´ ì‹œìŠ¤í…œ êµ¬ì¶•ì„ ìœ„í•´ ë‹´ë‹¹ì—…ë¬´ ë° ì¦ëª…ì‚¬ì§„ ë“±ë¡ì„ ìš”ì²­ë“œë¦½ë‹ˆë‹¤.</p>
        <div class="sub-header-meta">
            <div class="meta-item">ë‹´ë‹¹: <b>ê²½ì˜ê´€ë¦¬íŒ€ ê¹€ìœ ë¦¼</b></div>
            <div class="meta-item">ë§ˆê°: <span class="tag">2025.02.19</span></div>
        </div>
    </div>

    <details class="info-section" open>
        <summary class="info-header">ğŸ“– ì‘ì„± ì•ˆë‚´</summary>
        <div class="info-body">
            <div class="info-row">
                <div class="info-num">1</div>
                <div class="info-text">
                    <div class="info-title">ë‹´ë‹¹ì—…ë¬´ ê¸°ì¬</div>
                    <div style="display:inline-block;background:var(--accent);color:#fff;font-size:11px;font-weight:700;padding:2px 10px;border-radius:4px;margin-bottom:8px;">ì‘ì„±ì : íŒ€ë³„ ë¦¬ë“œ</div>
                    <div class="info-desc">
                        ê° íŒ€ ë¦¬ë“œê»˜ì„œ <b>ë³¸ì¸ í¬í•¨ íŒ€ì›ë³„ ë‹´ë‹¹ì—…ë¬´</b>ë¥¼ ì‘ì„±í•˜ì—¬ ì œì¶œí•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.<br>
                        ê¸°ì¬ëœ ë‹´ë‹¹ì—…ë¬´ëŠ” ì¶”í›„ <b>"ì´ ì—…ë¬´ëŠ” ëˆ„ê°€ ë‹´ë‹¹í•˜ëŠ”ì§€"</b>ë¥¼ ë¹ ë¥´ê²Œ í™•ì¸í•˜ê¸° ìœ„í•œ <b>ê²€ìƒ‰ ì •ë³´</b>ë¡œ í™œìš©ë©ë‹ˆë‹¤.
                    </div>
                    <div class="info-box example">
                        âœï¸ <b>ì—…ë¬´ í‚¤ì›Œë“œ + ì±„ë„ëª…</b> í˜•ì‹ìœ¼ë¡œ ê°„ë‹¨íˆ ê¸°ì¬<br>
                        Â· ë™ì¼ ì—…ë¬´ë¼ë„ <b>ì±„ë„ë³„ ë‹´ë‹¹ìê°€ ë‹¤ë¥¼ ê²½ìš° êµ¬ë¶„</b>í•˜ì—¬ ê¸°ì…<br>
                        ì˜ˆ) <b>ìƒì‚°ê´€ë¦¬</b>, <b>ì½˜í…ì¸  ê¸°íš(ë„·í¼)</b>, <b>ì½˜í…ì¸  ê¸°íš(POURê³µë²•)</b>
                    </div>
                    <div class="info-box warning">
                        ğŸ“Œ <b>ì£¼ì—…ë¬´ 2ê°œ</b>ëŠ” í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤. ê°€ì¥ ì¤‘ìš”í•œ ì—…ë¬´ë¥¼ ê¸°ì…í•´ ì£¼ì„¸ìš”.<br>
                        Â· <b>ê¸°íƒ€ì—…ë¬´</b>ëŠ” ì„ íƒì‚¬í•­ì´ë©°, <b>"+ ê¸°íƒ€ì—…ë¬´ ì¶”ê°€"</b> ë²„íŠ¼ìœ¼ë¡œ ììœ ë¡­ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </div>
                </div>
            </div>
            <div class="info-video-section">
                <div class="info-video-label">â–¶ ì„ì§ì› ë° ì—…ë¬´ ê²€ìƒ‰ ì˜ˆì‹œ</div>
                <div class="info-video" onclick="openVideoModal()">
                    <video autoplay loop muted playsinline>
                        <source src="video.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="info-video-hint">ğŸ” í´ë¦­í•˜ë©´ í¬ê²Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
            </div>
            <div class="info-row">
                <div class="info-num">2</div>
                <div class="info-text">
                    <div class="info-title">ì¦ëª…ì‚¬ì§„ ì œì¶œ</div>
                    <div style="display:inline-block;background:var(--accent-blue);color:#fff;font-size:11px;font-weight:700;padding:2px 10px;border-radius:4px;margin-bottom:8px;">ì‘ì„±ì : ê°œì¸ë³„</div>
                    <div class="info-desc">
                        ë³¸ì¸ ì´ë¦„ì„ ì„ íƒ í›„ ì¦ëª…ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”.<br>
                        â€» ì¦ëª…ì‚¬ì§„ì´ ì—†ëŠ” ê²½ìš°, <b>ì–¼êµ´ ì‹ë³„ì´ ê°€ëŠ¥í•œ ì •ë©´ ì‚¬ì§„</b>ìœ¼ë¡œ ëŒ€ì²´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
            <div style="padding:0 20px 20px;">
                <details class="info-preview">
                    <summary>ğŸ“‹ <b style="color:var(--text);">ì‘ì„± ì™„ë£Œ ì˜ˆì‹œ ë³´ê¸°</b></summary>
                    <div class="info-preview-img">
                        <img src="preview_sample.png" alt="ì§ì› ë“±ë¡ ì˜ˆì‹œ">
                        <div class="info-hl" style="top:9%;left:29%;width:42%;height:22%;"><span class="info-hl-tag">ì¦ëª…ì‚¬ì§„</span></div>
                        <div class="info-hl" style="top:62%;left:3%;width:94%;height:33%;"><span class="info-hl-tag">ì—…ë¬´</span></div>
                    </div>
                </details>
            </div>
        </div>
    </details>

    <div class="tabs">
        <div class="tab on" onclick="switchTab('task')">ğŸ“‹ ë‹´ë‹¹ì—…ë¬´ ì…ë ¥ (ë¦¬ë“œìš©)</div>
        <div class="tab" onclick="switchTab('photo')">ğŸ“· ì¦ëª…ì‚¬ì§„ ì—…ë¡œë“œ (ê°œì¸)</div>
    </div>

    <div class="tab-content">
        <!-- ëª¨ë“œ1: ë‹´ë‹¹ì—…ë¬´ -->
        <div class="panel on" id="pTask">
            <div id="taskStatArea" style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:16px;"></div>
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ‘¤</div>
                    <div>
                        <div class="card-title">ë¦¬ë“œ ì„ íƒ</div>
                        <div class="card-sub">ë³¸ì¸ ì´ë¦„ì„ ì„ íƒí•˜ë©´ íŒ€ì›ì´ í‘œì‹œë©ë‹ˆë‹¤</div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">ë¦¬ë“œ</label>
                        <select class="form-select" id="leadSel" onchange="selectLead()">
                            <option value="">-- ë¦¬ë“œ ì„ íƒ --</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="teamArea"></div>
            <div class="actions" id="taskActions" style="display:none">
                <button class="btn btn-g" onclick="saveTaskData()">ğŸ’¾ ì €ì¥</button>
            </div>
            <div class="save-status" id="taskSaveStatus"></div>
            <div id="taskDlArea" style="display:none;margin-top:12px;">
                <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap;">
                    <button class="btn btn-sm btn-p" onclick="dlTaskJSON()">ğŸ“¥ JSON ë‹¤ìš´ë¡œë“œ</button>
                    <button class="btn btn-sm" onclick="dlTaskCSV()">ğŸ“Š ì—‘ì…€(CSV) ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>
        </div>

        <!-- ëª¨ë“œ2: ì‚¬ì§„ -->
        <div class="panel" id="pPhoto">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon" style="background:var(--green);">ğŸ“·</div>
                    <div>
                        <div class="card-title">ì¦ëª…ì‚¬ì§„ ì—…ë¡œë“œ</div>
                        <div class="card-sub">ë³¸ì¸ ì´ë¦„ì„ í´ë¦­í•˜ì—¬ ì‚¬ì§„ì„ ë“±ë¡í•˜ì„¸ìš”</div>
                    </div>
                </div>
                <div class="card-body">
                    <div id="photoStatArea"></div>
                    <input type="text" class="search-input" id="photoSearch" placeholder="ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." oninput="filterPhotoList()">
                    <div class="person-list" id="photoList"></div>

                    <!-- ê´€ë¦¬ì ë„êµ¬ -->
                    <details class="admin-area">
                        <summary>ğŸ”§ ê´€ë¦¬ì ë„êµ¬</summary>
                        <div class="admin-inner">
                            <div class="admin-lock" id="adminLock">
                                <input type="password" id="adminPwInput" placeholder="ë¹„ë°€ë²ˆí˜¸" maxlength="10" onkeydown="if(event.key==='Enter')unlockAdmin()">
                                <button class="btn btn-sm btn-p" onclick="unlockAdmin()">ğŸ”“ í™•ì¸</button>
                                <span class="lock-msg" id="lockMsg"></span>
                            </div>
                            <div class="admin-content" id="adminContent">
                                <div class="admin-section-title">ğŸ“· ì‚¬ì§„ ë°ì´í„°</div>
                                <div class="admin-btns">
                                    <button class="btn btn-sm btn-p" onclick="downloadAllPhotos()">ğŸ“¥ ì‚¬ì§„ JSON ë‹¤ìš´ë¡œë“œ</button>
                                    <button class="btn btn-sm" onclick="downloadPhotoStatus()">ğŸ“Š ì‚¬ì§„ ì œì¶œí˜„í™© CSV</button>
                                </div>
                                <div class="admin-section-title">ğŸ“‹ ë‹´ë‹¹ì—…ë¬´ ë°ì´í„° (ì „ì²´ ì·¨í•©)</div>
                                <div class="admin-btns">
                                    <button class="btn btn-sm btn-p" onclick="downloadAllTasksJSON()">ğŸ“¥ ì—…ë¬´ ì „ì²´ JSON</button>
                                    <button class="btn btn-sm" onclick="downloadAllTasksCSV()">ğŸ“Š ì—…ë¬´ ì „ì²´ CSV</button>
                                </div>
                                <div class="admin-section-title">ğŸ“¦ ì „ì²´ í†µí•© (ì—…ë¬´ + ì‚¬ì§„)</div>
                                <div class="admin-btns">
                                    <button class="btn btn-sm btn-g" onclick="downloadAllMergedJSON()">ğŸ“¥ í†µí•© JSON ë‹¤ìš´ë¡œë“œ</button>
                                </div>
                                <div id="n8nAdminArea" style="display:none">
                                    <div class="admin-section-title">â˜ï¸ n8n ì„œë²„ ë°ì´í„°</div>
                                    <div class="admin-btns">
                                        <button class="btn btn-sm btn-p" onclick="fetchN8nData('status')">ğŸ“Š ì œì¶œ í˜„í™©</button>
                                        <button class="btn btn-sm btn-g" onclick="fetchN8nData('all')">ğŸ“¥ ì„œë²„ í†µí•© JSON</button>
                                        <button class="btn btn-sm" onclick="fetchN8nData('tasks')">ğŸ“‹ ì„œë²„ ì—…ë¬´</button>
                                        <button class="btn btn-sm" onclick="fetchN8nData('photos')">ğŸ“· ì„œë²„ ì‚¬ì§„</button>
                                    </div>
                                    <div id="n8nResult" style="margin-top:10px;"></div>
                                </div>
                            </div>
                        </div>
                    </details>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <span>Â© 2025 NETFORM R&D</span>
        <span>ì§ì› ì •ë³´ ì‹œìŠ¤í…œ v1.0</span>
    </div>
</div>

<!-- ì‚¬ì§„ ì—…ë¡œë“œ ëª¨ë‹¬ -->
<div class="modal-overlay" id="photoModal">
    <div class="modal">
        <button class="modal-close" onclick="closePhotoModal()">&times;</button>
        <div class="photo-circle" id="modalPreview" onclick="document.getElementById('photoFile').click()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
        </div>
        <div class="modal-name" id="modalName"></div>
        <div class="modal-sub" id="modalSub"></div>
        <p style="font-size:12px;color:var(--dim);margin-bottom:6px;">ì¦ëª…ì‚¬ì§„ ê¶Œì¥ (ì •ë©´, ë°ì€ ë°°ê²½)<br>í´ë¦­í•˜ì—¬ ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”</p>
        <input type="file" id="photoFile" accept="image/*" style="display:none" onchange="handleUserPhoto(event)">
        <div class="modal-btns">
            <button class="btn btn-sm" onclick="document.getElementById('photoFile').click()">ğŸ“ ì‚¬ì§„ ì„ íƒ</button>
            <button class="btn btn-sm btn-d" id="modalDelBtn" style="display:none" onclick="clearUserPhoto()">ğŸ—‘ ì‚­ì œ</button>
        </div>
        <div class="modal-btns" style="margin-top:10px;">
            <button class="btn btn-sm btn-g" id="modalSaveBtn" onclick="savePhotoData()">ğŸ’¾ ì €ì¥</button>
        </div>
    </div>
</div>

<!-- ë¹„ë””ì˜¤ í™•ëŒ€ ëª¨ë‹¬ -->
<div class="video-modal-overlay" id="videoModal" onclick="closeVideoModal()">
    <button class="video-modal-close" onclick="closeVideoModal()">&times;</button>
    <video id="videoModalPlayer" autoplay loop muted playsinline>
        <source src="video.mp4" type="video/mp4">
    </video>
</div>

<div class="toast" id="toast"></div>

<script>
// ===== ì„¤ì • =====
const STORE_KEY='nf_submit_v1';
const WEBHOOK_URL='https://nfrnd.app.n8n.cloud/webhook/emp-submit';
const STATUS_URL='https://nfrnd.app.n8n.cloud/webhook/emp-status';
const ADMIN_URL='';

function getStore(){try{return JSON.parse(localStorage.getItem(STORE_KEY))||{};}catch(e){return {};}}
function setStore(d){localStorage.setItem(STORE_KEY,JSON.stringify(d));}

// n8n Webhook ì „ì†¡
function sendToWebhook(type, records, submitter){
    if(!WEBHOOK_URL) return;
    try{
        fetch(WEBHOOK_URL,{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({type, records, submitter, timestamp:new Date().toISOString()})
        }).then(r=>{
            console.log('[n8n] ì „ì†¡ ì™„ë£Œ, status:', r.status);
        }).catch(e=>console.warn('[n8n] ì „ì†¡ ì‹¤íŒ¨ (ë¡œì»¬ ì €ì¥ì€ ì™„ë£Œ):', e));
    }catch(e){}
}

// ===== ì§ì› ë°ì´í„° (ã„±ã„´ã„·ìˆœ) =====
const EMP=[
    {name:'ê¶Œì •ì•„',division:'ì˜ì—…ë³¸ë¶€',team:'ì„œë¹„ìŠ¤ìš´ì˜2íŒ€',position:'ë¦¬ë“œ ë§¤ë‹ˆì €'},
    {name:'ê¶Œí˜œì˜',division:'ë¸Œëœë“œë§ˆì¼€íŒ…íŒ€',team:'ë¸Œëœë“œë§ˆì¼€íŒ…íŒ€',position:'ë¦¬ë“œ ë§¤ë‹ˆì €'},
    {name:'ê¹€ê²½ë¯¸',division:'ì˜ì—…ë³¸ë¶€',team:'ì„œë¹„ìŠ¤ìš´ì˜1íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ê¹€ë¯¼ì§€',division:'ì»¤ë¨¸ìŠ¤ì‚¬ì—…ë³¸ë¶€',team:'ë¸Œëœë“œì»¤ë¨¸ìŠ¤íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ê¹€ë²”ì„',division:'ê²½ì˜ê´€ë¦¬ë³¸ë¶€',team:'ê·¸ë¡œìŠ¤íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ê¹€ì„±ë¯¼',division:'ì˜ì—…ë³¸ë¶€',team:'ì„œë¹„ìŠ¤ìš´ì˜1íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ê¹€ì„±ì¤€',division:'ìš©ì¸ì‚¬ì—…ì¥',team:'ìš©ì¸ê³µì¥',position:'ê³µì¥ì¥'},
    {name:'ê¹€ì†Œë¼',division:'ë¸Œëœë“œë§ˆì¼€íŒ…íŒ€',team:'ë¸Œëœë“œë§ˆì¼€íŒ…íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ê¹€ì†Œì—°',division:'ì»¤ë¨¸ìŠ¤ì‚¬ì—…ë³¸ë¶€',team:'ë¯¸ë””ì–´ì»¤ë¨¸ìŠ¤íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ê¹€ì†Œì •',division:'ìš©ì¸ì‚¬ì—…ì¥',team:'ê±´ì„¤ ê¸°ìˆ ì—°êµ¬ì†Œ',position:'ì—°êµ¬ì›'},
    {name:'ê¹€ì†¡í¬',division:'ì»¤ë¨¸ìŠ¤ì‚¬ì—…ë³¸ë¶€',team:'ëª¨ì—¬ë¼ë”œíŒ€',position:'ë¦¬ë“œ ë§¤ë‹ˆì €'},
    {name:'ê¹€ìˆ˜ì§„',division:'ì˜ì—…ë³¸ë¶€',team:'ì„œë¹„ìŠ¤ìš´ì˜2íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ê¹€ìœ ë¦¼',division:'ê²½ì˜ê´€ë¦¬ë³¸ë¶€',team:'ê²½ì˜ê´€ë¦¬íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ê¹€ìœ ì§„',division:'ìš©ì¸ì‚¬ì—…ì¥',team:'ìƒì‚°/í’ˆì§ˆê´€ë¦¬íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ê¹€ì±„ì›',division:'ì»¤ë¨¸ìŠ¤ì‚¬ì—…ë³¸ë¶€',team:'í•´ì™¸ì‚¬ì—…íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ë‚¨ìœ¤ì •',division:'ì»¤ë¨¸ìŠ¤ì‚¬ì—…ë³¸ë¶€',team:'ë¯¸ë””ì–´ì»¤ë¨¸ìŠ¤íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ë°±ì •ì„',division:'ê²½ì˜ê´€ë¦¬ë³¸ë¶€',team:'ê²½ì˜ê´€ë¦¬ë³¸ë¶€',position:'ì´ì‚¬'},
    {name:'ì†ì˜ˆì§„',division:'ë¸Œëœë“œë§ˆì¼€íŒ…íŒ€',team:'ë¸Œëœë“œë§ˆì¼€íŒ…íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ì†¡ë³´ëŒ',division:'ì˜ì—…ë³¸ë¶€',team:'ì„œë¹„ìŠ¤ìš´ì˜3íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ì‹ ë‚˜ì˜',division:'ê²½ì˜ê´€ë¦¬ë³¸ë¶€',team:'ê²½ì˜ê´€ë¦¬íŒ€',position:'ë¦¬ë“œ ë§¤ë‹ˆì €'},
    {name:'ì‹ ëª…í¬',division:'ìš©ì¸ì‚¬ì—…ì¥',team:'ì†Œì¬ ê¸°ìˆ ì—°êµ¬ì†Œ',position:'ì„ ì„ì—°êµ¬ì›'},
    {name:'ì‹¬í˜œì§„',division:'ìš©ì¸ì‚¬ì—…ì¥',team:'ê±´ì„¤ ê¸°ìˆ ì—°êµ¬ì†Œ',position:'ì—°êµ¬ì›'},
    {name:'ì´ë‚˜ë¼',division:'ìš©ì¸ì‚¬ì—…ì¥',team:'ê´€ë¦¬íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ì´ë€',division:'ì»¤ë¨¸ìŠ¤ì‚¬ì—…ë³¸ë¶€',team:'ë¸Œëœë“œì»¤ë¨¸ìŠ¤íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ì´ìŠ¹ìš°',division:'ê²½ì˜ì´ê´„',team:'ê²½ì˜ì´ê´„',position:'ëŒ€í‘œì´ì‚¬'},
    {name:'ì´ì¬ë¯¼',division:'ìš©ì¸ì‚¬ì—…ì¥',team:'ìƒì‚°/í’ˆì§ˆê´€ë¦¬íŒ€',position:'ë¦¬ë“œ ë§¤ë‹ˆì €'},
    {name:'ì´ì¬í›ˆ',division:'ê²½ì˜ê´€ë¦¬ë³¸ë¶€',team:'ê·¸ë¡œìŠ¤íŒ€',position:'ë¦¬ë“œ ë§¤ë‹ˆì €'},
    {name:'ì´ì •í›ˆ',division:'ìš©ì¸ì‚¬ì—…ì¥',team:'ê±´ì„¤ ê¸°ìˆ ì—°êµ¬ì†Œ',position:'ê¸°ìˆ ì—°êµ¬ì†Œì¥'},
    {name:'ì´ì§€ì—°',division:'ì˜ì—…ë³¸ë¶€',team:'ì„œë¹„ìŠ¤ìš´ì˜2íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ì´ì±„ì€',division:'ì»¤ë¨¸ìŠ¤ì‚¬ì—…ë³¸ë¶€',team:'ëª¨ì—¬ë¼ë”œíŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ì´í•„ì„ ',division:'ì˜ì—…ë³¸ë¶€',team:'ì˜ì—…íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ì •ì˜ì¬',division:'ìš©ì¸ì‚¬ì—…ì¥',team:'ìš©ì¸ì‚¬ì—…ì¥',position:'ë¶€ì‚¬ì¥'},
    {name:'ì •ì •í›ˆ',division:'ì˜ì—…ë³¸ë¶€',team:'ì„œë¹„ìŠ¤ìš´ì˜1íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ì •íƒœìœ¤',division:'ì˜ì—…ë³¸ë¶€',team:'ì„¤ê³„/ì ì‚°íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ì¡°ì¬ì—°',division:'ì˜ì—…ë³¸ë¶€',team:'ì„œë¹„ìŠ¤ìš´ì˜1íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ì£¼ìœ ì§„',division:'ê²½ì˜ê´€ë¦¬ë³¸ë¶€',team:'ê²½ì˜ê´€ë¦¬íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ì£¼í˜„ì§„',division:'ì˜ì—…ë³¸ë¶€',team:'ì„œë¹„ìŠ¤ìš´ì˜3íŒ€',position:'ë¦¬ë“œ ë§¤ë‹ˆì €'},
    {name:'ì©í‹°ë¦¬',division:'ì»¤ë¨¸ìŠ¤ì‚¬ì—…ë³¸ë¶€',team:'í•´ì™¸ì‚¬ì—…íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ìµœê²½ì„ ',division:'ë¸Œëœë“œë§ˆì¼€íŒ…íŒ€',team:'ë¸Œëœë“œë§ˆì¼€íŒ…íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'ìµœì˜ì˜¥',division:'ê²½ì˜ê´€ë¦¬ë³¸ë¶€',team:'ê²½ì˜ê´€ë¦¬íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'í•œì¸ê·œ',division:'ì˜ì—…ë³¸ë¶€',team:'ì„¤ê³„/ì ì‚°íŒ€',position:'ë¦¬ë“œ ë§¤ë‹ˆì €'},
    {name:'í•œì¤€ì—½',division:'ì˜ì—…ë³¸ë¶€',team:'ì„œë¹„ìŠ¤ìš´ì˜1íŒ€',position:'ë¦¬ë“œ ë§¤ë‹ˆì €'},
    {name:'í•¨ì§€ë¯¼',division:'ë¸Œëœë“œë§ˆì¼€íŒ…íŒ€',team:'ë¸Œëœë“œë§ˆì¼€íŒ…íŒ€',position:'ë§¤ë‹ˆì €'},
    {name:'í™©ìœ¤ì„ ',division:'ì˜ì—…ë³¸ë¶€',team:'ì˜ì—…ë³¸ë¶€',position:'ìƒë¬´ì´ì‚¬'},
];

// ===== ë¦¬ë“œ ì„¤ì • =====
const EXCLUDE_LEAD=['ì´ìŠ¹ìš°','í™©ìœ¤ì„ ','ì •ì˜ì¬','ë°±ì •ì„','ì´ì •í›ˆ'];
const LEAD_POS=['ë¦¬ë“œ ë§¤ë‹ˆì €','ê³µì¥ì¥','ì„ ì„ì—°êµ¬ì›'];
const TEAM_LEAD_OVERRIDE={
    'í•´ì™¸ì‚¬ì—…íŒ€':'ê¹€ì±„ì›|í•´ì™¸ì‚¬ì—…íŒ€',
    'ë¸Œëœë“œì»¤ë¨¸ìŠ¤íŒ€':'ì´ë€|ë¸Œëœë“œì»¤ë¨¸ìŠ¤íŒ€',
    'ë¯¸ë””ì–´ì»¤ë¨¸ìŠ¤íŒ€':'ê¹€ì†Œì—°|ë¯¸ë””ì–´ì»¤ë¨¸ìŠ¤íŒ€',
    'ì˜ì—…íŒ€':'ì´í•„ì„ |ì˜ì—…íŒ€',
};
const OVERRIDE_EXCLUDE=['ì´ì¬í›ˆ|ë¯¸ë””ì–´ì»¤ë¨¸ìŠ¤íŒ€'];
const FACTORY_MANAGED=['ê´€ë¦¬íŒ€','ìƒì‚°/í’ˆì§ˆê´€ë¦¬íŒ€'];
const RESEARCH_EXTRA={'ì‹ ëª…í¬|ì†Œì¬ ê¸°ìˆ ì—°êµ¬ì†Œ':['ì‹¬í˜œì§„|ê±´ì„¤ ê¸°ìˆ ì—°êµ¬ì†Œ','ê¹€ì†Œì •|ê±´ì„¤ ê¸°ìˆ ì—°êµ¬ì†Œ']};

const leads=EMP.filter(e=>{
    if(EXCLUDE_LEAD.includes(e.name)) return false;
    if(FACTORY_MANAGED.includes(e.team)) return false;
    if(OVERRIDE_EXCLUDE.includes(e.name+'|'+e.team)) return false;
    if(LEAD_POS.includes(e.position)) return true;
    const ov=TEAM_LEAD_OVERRIDE[e.team];
    if(ov&&ov===e.name+'|'+e.team) return true;
    return false;
});

// íƒ­ ì „í™˜
function switchTab(t){
    document.querySelectorAll('.tab').forEach((b,i)=>b.classList.toggle('on',i===(t==='task'?0:1)));
    document.getElementById('pTask').className='panel'+(t==='task'?' on':'');
    document.getElementById('pPhoto').className='panel'+(t==='photo'?' on':'');
    if(t==='photo') renderPhotoStat();
    if(t==='task') renderTaskStat();
}

// ===== ëª¨ë“œ1: ë‹´ë‹¹ì—…ë¬´ =====
function initLeadSel(){
    const sel=document.getElementById('leadSel');
    leads.forEach(l=>{
        const o=document.createElement('option');
        o.value=l.name+'|'+l.team;
        o.textContent=`${l.name} (${l.team} Â· ${l.position})`;
        sel.appendChild(o);
    });
}

let curLead=null;
let allMembers=[];
function selectLead(){
    const v=document.getElementById('leadSel').value;
    if(!v){document.getElementById('teamArea').innerHTML='';document.getElementById('taskActions').style.display='none';document.getElementById('taskSaveStatus').style.display='none';curLead=null;return;}
    const [name,team]=v.split('|');
    curLead={name,team};
    const lead=EMP.find(e=>e.name===name&&e.team===team)||EMP.find(e=>e.name===name);

    const FACTORY_TEAMS=['ìš©ì¸ê³µì¥','ê´€ë¦¬íŒ€','ìƒì‚°/í’ˆì§ˆê´€ë¦¬íŒ€'];
    let teamMembers;
    if(lead.position==='ê³µì¥ì¥'){
        teamMembers=EMP.filter(e=>FACTORY_TEAMS.includes(e.team)&&e.name!==name);
    } else {
        teamMembers=EMP.filter(e=>e.team===team&&e.name!==name);
    }

    const extraKey=name+'|'+team;
    if(RESEARCH_EXTRA[extraKey]){
        RESEARCH_EXTRA[extraKey].forEach(key=>{
            const [eName,eTeam]=key.split('|');
            const emp=EMP.find(e=>e.name===eName&&e.team===eTeam);
            if(emp&&!teamMembers.includes(emp)) teamMembers.push(emp);
        });
    }

    allMembers=[lead,...teamMembers];
    renderTeamMembers(allMembers);
    document.getElementById('taskActions').style.display='flex';
    document.getElementById('taskSaveStatus').style.display='none';
}

function renderTeamMembers(members){
    const area=document.getElementById('teamArea');
    if(!members.length){area.innerHTML='<div class="empty-msg">í•´ë‹¹ íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>';return;}
    const store=getStore();
    area.innerHTML=members.map((m,i)=>{
        const storeKey=m.name+'|'+m.team;
        const saved=store['task_'+storeKey];
        const tasks=saved||[];
        const isLead=(i===0);
        // ì£¼ì—…ë¬´ 2ê°œ (ê³ ì •)
        let primaryInputs='';
        for(let j=0;j<2;j++){
            primaryInputs+=`<div class="task-row"><input class="task-input primary-task" data-member="${i}" data-type="primary" placeholder="ì£¼ì—…ë¬´ ${j+1}" value="${tasks[j]||''}"></div>`;
        }
        // ê¸°íƒ€ì—…ë¬´ (3ë²ˆë¶€í„°, ììœ  ì¶”ê°€/ì‚­ì œ)
        let secondaryInputs='';
        const secTasks=tasks.slice(2);
        const secRows=Math.max(1,secTasks.length);
        for(let j=0;j<secRows;j++){
            secondaryInputs+=`<div class="task-row"><input class="task-input" data-member="${i}" data-type="secondary" placeholder="ê¸°íƒ€ì—…ë¬´ ${j+1}" value="${secTasks[j]||''}"><button class="btn-del-task" onclick="delRow(this)" title="ì‚­ì œ">&times;</button></div>`;
        }
        return `<div class="member${isLead?' is-lead':''}" data-idx="${i}">
            <div class="member-head">
                <div class="member-av">${m.name[0]}</div>
                <div class="member-info"><div class="member-nm">${m.name}${isLead?' <span class="member-badge">ë³¸ì¸</span>':''}</div><div class="member-pos">${m.position} Â· ${m.team}</div></div>
            </div>
            <div class="member-body">
                <div class="task-section-label"><span class="tsl-badge primary">í•„ìˆ˜</span> ì£¼ì—…ë¬´ (2ê°œ)</div>
                <div class="task-rows" id="primaryRows${i}">${primaryInputs}</div>
                <div class="task-divider"></div>
                <div class="task-section-label"><span class="tsl-badge secondary">ì„ íƒ</span> ê¸°íƒ€ì—…ë¬´</div>
                <div class="task-rows" id="secRows${i}">${secondaryInputs}</div>
                <button class="btn-add-task" onclick="addSecRow(${i})">+ ê¸°íƒ€ì—…ë¬´ ì¶”ê°€</button>
            </div>
        </div>`;
    }).join('');
}

function addSecRow(idx){
    const rows=document.getElementById('secRows'+idx);
    const n=rows.querySelectorAll('.task-input').length+1;
    const div=document.createElement('div');
    div.className='task-row';
    div.innerHTML=`<input class="task-input" data-member="${idx}" data-type="secondary" placeholder="ê¸°íƒ€ì—…ë¬´ ${n}"><button class="btn-del-task" onclick="delRow(this)" title="ì‚­ì œ">&times;</button>`;
    rows.appendChild(div);
    div.querySelector('.task-input').focus();
}

function delRow(btn){
    const row=btn.closest('.task-row');
    const rows=row.parentElement;
    if(rows.querySelectorAll('.task-row').length<=1){
        row.querySelector('.task-input').value='';
        return;
    }
    row.remove();
    rows.querySelectorAll('.task-input').forEach((inp,j)=>{inp.placeholder='ê¸°íƒ€ì—…ë¬´ '+(j+1);});
}

function saveTaskData(){
    if(!allMembers||!allMembers.length){toast('íŒ€ì› ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.','err');return;}
    const store=getStore();
    let count=0;
    allMembers.forEach((m,i)=>{
        const pri=[...document.getElementById('primaryRows'+i).querySelectorAll('.task-input')].map(inp=>inp.value.trim());
        const sec=[...document.getElementById('secRows'+i).querySelectorAll('.task-input')].map(inp=>inp.value.trim()).filter(Boolean);
        const tasks=[...pri,...sec];
        store['task_'+m.name+'|'+m.team]=tasks;
        count++;
    });
    setStore(store);
    const webhookRecords=allMembers.map((m,i)=>{
        const pri=[...document.getElementById('primaryRows'+i).querySelectorAll('.task-input')].map(inp=>inp.value.trim());
        const sec=[...document.getElementById('secRows'+i).querySelectorAll('.task-input')].map(inp=>inp.value.trim()).filter(Boolean);
        return {name:m.name,division:m.division,team:m.team,position:m.position,primaryTasks:pri,secondaryTasks:sec};
    }).filter(d=>d.primaryTasks.some(Boolean)||d.secondaryTasks.length);
    if(webhookRecords.length) sendToWebhook('task',webhookRecords,curLead.name);
    const status=document.getElementById('taskSaveStatus');
    status.textContent=`âœ… ${count}ëª… ë‹´ë‹¹ì—…ë¬´ ì €ì¥ ì™„ë£Œ (${new Date().toLocaleTimeString()})`;
    status.style.display='block';
    document.getElementById('taskDlArea').style.display='block';
    toast(`${count}ëª… ë‹´ë‹¹ì—…ë¬´ ì €ì¥ ì™„ë£Œ!`,'ok');
    renderTaskStat();
    // 3ì´ˆ í›„ ì„œë²„ í˜„í™© ê°±ì‹  (ì„œë²„ ë°˜ì˜ ì‹œê°„ ê³ ë ¤)
    setTimeout(fetchServerStatus, 3000);
}

function dlTaskJSON(){
    if(!allMembers||!allMembers.length){toast('ë¨¼ì € ì €ì¥í•´ì£¼ì„¸ìš”.','err');return;}
    const result=allMembers.map((m,i)=>{
        const pri=[...document.getElementById('primaryRows'+i).querySelectorAll('.task-input')].map(inp=>inp.value.trim());
        const sec=[...document.getElementById('secRows'+i).querySelectorAll('.task-input')].map(inp=>inp.value.trim());
        const tasks=[...pri,...sec].filter(Boolean);
        return {name:m.name,division:m.division,team:m.team,position:m.position,primaryTasks:tasks};
    }).filter(d=>d.primaryTasks.length);
    if(!result.length){toast('ì…ë ¥ëœ ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤.','err');return;}
    downloadJSON(result,`ë‹´ë‹¹ì—…ë¬´_${curLead.team}_${curLead.name}`);
    toast('JSON ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!','ok');
}

function dlTaskCSV(){
    if(!allMembers||!allMembers.length){toast('ë¨¼ì € ì €ì¥í•´ì£¼ì„¸ìš”.','err');return;}
    const rows=[['ì´ë¦„','ë³¸ë¶€','íŒ€','ì§ê¸‰','ì£¼ì—…ë¬´1','ì£¼ì—…ë¬´2','ê¸°íƒ€ì—…ë¬´1','ê¸°íƒ€ì—…ë¬´2','ê¸°íƒ€ì—…ë¬´3']];
    allMembers.forEach((m,i)=>{
        const pri=[...document.getElementById('primaryRows'+i).querySelectorAll('.task-input')].map(inp=>inp.value.trim());
        const sec=[...document.getElementById('secRows'+i).querySelectorAll('.task-input')].map(inp=>inp.value.trim());
        const tasks=[...pri,...sec].filter(Boolean);
        if(tasks.length){
            const row=[m.name,m.division,m.team,m.position];
            for(let j=0;j<5;j++) row.push(tasks[j]||'');
            rows.push(row);
        }
    });
    if(rows.length<=1){toast('ì…ë ¥ëœ ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤.','err');return;}
    downloadCSV(rows,`ë‹´ë‹¹ì—…ë¬´_${curLead.team}_${curLead.name}`);
    toast('ì—‘ì…€(CSV) ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!','ok');
}

// ===== ëª¨ë“œ2: ì‚¬ì§„ =====
let photoTarget=null,photoData='';

// ì„œë²„ í˜„í™© ë°ì´í„°
let serverStatus={taskNames:[],photoNames:[],taskCount:0,photoCount:0,loaded:false};

function fetchServerStatus(){
    if(!STATUS_URL) return;
    fetch(STATUS_URL).then(r=>r.json()).then(data=>{
        serverStatus={
            taskNames:data.taskNames||[],
            photoNames:data.photoNames||[],
            taskCount:data.taskCount||0,
            photoCount:data.photoCount||0,
            loaded:true
        };
        // ì‚¬ì§„ íƒ­ì´ ì—´ë ¤ìˆìœ¼ë©´ í˜„í™© ê°±ì‹ 
        renderPhotoStat();
        renderPhotoList(document.getElementById('photoSearch')?.value.trim()||'');
        // ì—…ë¬´ íƒ­ í˜„í™©ë„ ê°±ì‹ 
        renderTaskStat();
        console.log('[ì„œë²„] í˜„í™© ì¡°íšŒ ì™„ë£Œ - ì—…ë¬´:'+serverStatus.taskCount+'ëª…, ì‚¬ì§„:'+serverStatus.photoCount+'ëª…');
    }).catch(e=>{
        console.warn('[ì„œë²„] í˜„í™© ì¡°íšŒ ì‹¤íŒ¨:', e);
        serverStatus.loaded=false;
    });
}

function getPhotoStats(){
    // ì„œë²„ ë°ì´í„° + ë¡œì»¬ ë°ì´í„° ë³‘í•©
    const store=getStore();
    const doneSet=new Set();
    // ì„œë²„ì—ì„œ ì‚¬ì§„ ë“±ë¡ëœ ì´ë¦„
    serverStatus.photoNames.forEach(n=>doneSet.add(n));
    // ë¡œì»¬ì—ì„œ ì‚¬ì§„ ë“±ë¡ëœ ì´ë¦„
    EMP.forEach(e=>{if(store['photo_'+e.name+'|'+e.team]) doneSet.add(e.name);});
    const done=doneSet.size;
    return {total:EMP.length, done, remain:EMP.length-done, doneNames:doneSet};
}

function getTaskStats(){
    const store=getStore();
    const doneSet=new Set();
    serverStatus.taskNames.forEach(n=>doneSet.add(n));
    EMP.forEach(e=>{const tasks=store['task_'+e.name+'|'+e.team];if(tasks&&tasks.some(Boolean)) doneSet.add(e.name);});
    return {total:EMP.length, done:doneSet.size, remain:EMP.length-doneSet.size, doneNames:doneSet};
}

function renderPhotoStat(){
    const s=getPhotoStats();
    const pct=s.total?Math.round(s.done/s.total*100):0;
    const statusTag=serverStatus.loaded?'<span style="font-size:10px;color:var(--green);font-weight:600;margin-left:8px;">â— ì„œë²„ ì—°ë™</span>':'';
    document.getElementById('photoStatArea').innerHTML=`
        <div style="font-size:11px;color:var(--sub);margin-bottom:8px;font-weight:600;">ğŸ“· ì‚¬ì§„ ì œì¶œ í˜„í™©${statusTag}</div>
        <div class="stat-bar">
            <div class="stat-item stat-total"><div class="stat-label">ì „ì²´</div><span class="stat-n">${s.total}</span></div>
            <div class="stat-item stat-done"><div class="stat-label">ì™„ë£Œ</div><span class="stat-n">${s.done}</span></div>
            <div class="stat-item stat-remain"><div class="stat-label">ë¯¸ì™„ë£Œ</div><span class="stat-n">${s.remain}</span></div>
        </div>
        <div class="progress-wrap"><div class="progress-bar"><div class="fill" style="width:${pct}%"></div></div><span class="progress-pct">${pct}%</span></div>`;
}

function renderTaskStat(){
    const el=document.getElementById('taskStatArea');
    if(!el) return;
    const s=getTaskStats();
    const pct=s.total?Math.round(s.done/s.total*100):0;
    const statusTag=serverStatus.loaded?'<span style="font-size:10px;color:var(--green);font-weight:600;margin-left:8px;">â— ì„œë²„ ì—°ë™</span>':'';
    el.innerHTML=`
        <div style="font-size:11px;color:var(--sub);margin-bottom:8px;font-weight:600;">ğŸ“‹ ì—…ë¬´ ì œì¶œ í˜„í™©${statusTag}</div>
        <div class="stat-bar">
            <div class="stat-item stat-total"><div class="stat-label">ì „ì²´</div><span class="stat-n">${s.total}</span></div>
            <div class="stat-item stat-done"><div class="stat-label">ì™„ë£Œ</div><span class="stat-n">${s.done}</span></div>
            <div class="stat-item stat-remain"><div class="stat-label">ë¯¸ì™„ë£Œ</div><span class="stat-n">${s.remain}</span></div>
        </div>
        <div class="progress-wrap"><div class="progress-bar"><div class="fill" style="width:${pct}%"></div></div><span class="progress-pct">${pct}%</span></div>`;
}

function initPhotoList(){renderPhotoStat();renderPhotoList('');}
function filterPhotoList(){renderPhotoList(document.getElementById('photoSearch').value.trim());}

function renderPhotoList(q){
    const list=document.getElementById('photoList');
    const filtered=q?EMP.filter(e=>e.name.includes(q)):EMP;
    const store=getStore();
    const photoStats=getPhotoStats();
    list.innerHTML=filtered.map(e=>{
        const idx=EMP.indexOf(e);
        const localPhoto=store['photo_'+e.name+'|'+e.team];
        const serverPhoto=photoStats.doneNames.has(e.name);
        const hasPhoto=localPhoto||serverPhoto;
        const badge=hasPhoto
            ?(localPhoto?'<span class="done-badge">âœ… ë“±ë¡ì™„ë£Œ</span>':'<span class="done-badge" style="background:#eff6ff;color:var(--accent-blue);">â˜ï¸ ì„œë²„ë“±ë¡</span>')
            :'<span class="undone-badge">ë¯¸ë“±ë¡</span>';
        return `<div class="person-item${hasPhoto?' on':''}" onclick="openPhotoModal(${idx})">
        <div class="p-av">${e.name[0]}</div>
        <div><div class="p-nm">${e.name}</div><div class="p-info">${e.team} Â· ${e.position}</div></div>
        ${badge}
    </div>`;
    }).join('');
}

function openPhotoModal(idx){
    const e=EMP[idx];if(!e)return;
    photoTarget=e;photoData='';
    const store=getStore();
    const saved=store['photo_'+e.name+'|'+e.team];
    document.getElementById('modalName').textContent=e.name;
    document.getElementById('modalSub').textContent=`${e.team} Â· ${e.position}`;
    const preview=document.getElementById('modalPreview');
    if(saved){
        photoData=saved;
        preview.innerHTML=`<img src="${saved}">`;
        preview.classList.add('has-photo');
        document.getElementById('modalDelBtn').style.display='inline-flex';
    } else {
        preview.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>';
        preview.classList.remove('has-photo');
        document.getElementById('modalDelBtn').style.display='none';
    }
    document.getElementById('photoFile').value='';
    document.getElementById('photoModal').classList.add('show');
}

function closePhotoModal(){
    document.getElementById('photoModal').classList.remove('show');
    photoTarget=null;photoData='';
}

function handleUserPhoto(ev){
    const file=ev.target.files[0];if(!file)return;
    const reader=new FileReader();
    reader.onload=function(e){
        const img=new Image();
        img.onload=function(){
            const max=300,c=document.createElement('canvas');
            let w=img.width,h=img.height;
            if(w>h){if(w>max){h=h*max/w;w=max;}}else{if(h>max){w=w*max/h;h=max;}}
            c.width=w;c.height=h;c.getContext('2d').drawImage(img,0,0,w,h);
            photoData=c.toDataURL('image/jpeg',0.8);
            const preview=document.getElementById('modalPreview');
            preview.innerHTML=`<img src="${photoData}">`;
            preview.classList.add('has-photo');
            document.getElementById('modalDelBtn').style.display='inline-flex';
        };
        img.src=e.target.result;
    };
    reader.readAsDataURL(file);
}

function clearUserPhoto(){
    photoData='';
    document.getElementById('photoFile').value='';
    const preview=document.getElementById('modalPreview');
    preview.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>';
    preview.classList.remove('has-photo');
    document.getElementById('modalDelBtn').style.display='none';
    if(photoTarget){
        const store=getStore();
        delete store['photo_'+photoTarget.name+'|'+photoTarget.team];
        setStore(store);
        renderPhotoStat();
        renderPhotoList(document.getElementById('photoSearch').value.trim());
        toast('ì‚¬ì§„ ì‚­ì œ ì™„ë£Œ','ok');
    }
}

function savePhotoData(){
    if(!photoTarget){toast('ì„ íƒëœ ì‚¬ëŒì´ ì—†ìŠµë‹ˆë‹¤.','err');return;}
    if(!photoData){toast('ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.','err');return;}
    const store=getStore();
    store['photo_'+photoTarget.name+'|'+photoTarget.team]=photoData;
    setStore(store);
    sendToWebhook('photo',[{name:photoTarget.name,division:photoTarget.division,team:photoTarget.team,position:photoTarget.position,photo:photoData}],photoTarget.name);
    toast(`${photoTarget.name} ì‚¬ì§„ ì €ì¥ ì™„ë£Œ!`,'ok');
    closePhotoModal();
    renderPhotoStat();
    renderPhotoList(document.getElementById('photoSearch').value.trim());
    setTimeout(fetchServerStatus, 3000);
}

// ===== ê´€ë¦¬ì ë„êµ¬ =====
const ADMIN_PW='1212';
function unlockAdmin(){
    const inp=document.getElementById('adminPwInput');
    const msg=document.getElementById('lockMsg');
    if(inp.value===ADMIN_PW){
        document.getElementById('adminLock').style.display='none';
        document.getElementById('adminContent').style.display='block';
        msg.textContent='';
    }else{
        msg.textContent='ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.';
        inp.value='';inp.focus();
        setTimeout(()=>msg.textContent='',2000);
    }
}

function downloadAllPhotos(){
    const store=getStore();
    const result=[];
    EMP.forEach(e=>{const photo=store['photo_'+e.name+'|'+e.team];if(photo) result.push({name:e.name,division:e.division,team:e.team,position:e.position,photo});});
    if(!result.length){toast('ë“±ë¡ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.','err');return;}
    downloadJSON(result,`ì‚¬ì§„_ì „ì²´_${result.length}ëª…`);
    toast(`${result.length}ëª… ì‚¬ì§„ JSON ë‹¤ìš´ë¡œë“œ ì™„ë£Œ`,'ok');
}

function downloadPhotoStatus(){
    const store=getStore();
    const rows=[['ì´ë¦„','ë³¸ë¶€','íŒ€','ì§ê¸‰','ì‚¬ì§„ ì œì¶œì—¬ë¶€']];
    EMP.forEach(e=>{rows.push([e.name,e.division,e.team,e.position,store['photo_'+e.name+'|'+e.team]?'ì™„ë£Œ':'ë¯¸ì œì¶œ']);});
    downloadCSV(rows,'ì‚¬ì§„_ì œì¶œí˜„í™©');
    toast('ì‚¬ì§„ ì œì¶œí˜„í™© CSV ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!','ok');
}

function downloadAllTasksJSON(){
    const store=getStore();
    const result=[];
    EMP.forEach(e=>{const tasks=store['task_'+e.name+'|'+e.team];if(tasks&&tasks.length) result.push({name:e.name,division:e.division,team:e.team,position:e.position,primaryTasks:tasks});});
    if(!result.length){toast('ì €ì¥ëœ ì—…ë¬´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.','err');return;}
    downloadJSON(result,`ë‹´ë‹¹ì—…ë¬´_ì „ì²´_${result.length}ëª…`);
    toast(`${result.length}ëª… ì—…ë¬´ JSON ë‹¤ìš´ë¡œë“œ ì™„ë£Œ`,'ok');
}

function downloadAllTasksCSV(){
    const store=getStore();
    const rows=[['ì´ë¦„','ë³¸ë¶€','íŒ€','ì§ê¸‰','ì£¼ì—…ë¬´1','ì£¼ì—…ë¬´2','ì—…ë¬´3','ì—…ë¬´4','ì—…ë¬´5','ì…ë ¥ì—¬ë¶€']];
    EMP.forEach(e=>{
        const tasks=store['task_'+e.name+'|'+e.team]||[];
        const row=[e.name,e.division,e.team,e.position];
        for(let j=0;j<5;j++) row.push(tasks[j]||'');
        row.push(tasks.length?'ì™„ë£Œ':'ë¯¸ì…ë ¥');
        rows.push(row);
    });
    downloadCSV(rows,'ë‹´ë‹¹ì—…ë¬´_ì „ì²´');
    toast('ë‹´ë‹¹ì—…ë¬´ ì „ì²´ CSV ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!','ok');
}

function downloadAllMergedJSON(){
    const store=getStore();
    const result=[];
    let taskCnt=0,photoCnt=0;
    EMP.forEach(e=>{
        const tasks=store['task_'+e.name+'|'+e.team];
        const photo=store['photo_'+e.name+'|'+e.team];
        if((tasks&&tasks.length)||photo){
            const obj={name:e.name,division:e.division,team:e.team,position:e.position};
            if(tasks&&tasks.length){obj.primaryTasks=tasks;taskCnt++;}
            if(photo){obj.photo=photo;photoCnt++;}
            result.push(obj);
        }
    });
    if(!result.length){toast('ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.','err');return;}
    downloadJSON(result,`í†µí•©_ì—…ë¬´${taskCnt}ëª…_ì‚¬ì§„${photoCnt}ëª…`);
    toast(`í†µí•© JSON(ì—…ë¬´ ${taskCnt}ëª… + ì‚¬ì§„ ${photoCnt}ëª…) ë‹¤ìš´ë¡œë“œ ì™„ë£Œ`,'ok');
}

// ===== n8n ì„œë²„ ë°ì´í„° ì¡°íšŒ =====
function fetchN8nData(mode){
    if(!ADMIN_URL){toast('ADMIN_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.','err');return;}
    const url=ADMIN_URL+(ADMIN_URL.includes('?')?'&':'?')+'mode='+mode;
    fetch(url).then(r=>r.json()).then(data=>{
        const el=document.getElementById('n8nResult');
        if(mode==='status'){
            el.innerHTML=`<div style="background:var(--accent-light);border:1px solid var(--border);border-radius:6px;padding:14px;font-size:13px;line-height:1.7;">
                <b>â˜ï¸ ì„œë²„ ì·¨í•© í˜„í™©</b><br>
                ğŸ“‹ ë‹´ë‹¹ì—…ë¬´: <b>${data.taskCount}ëª…</b> Â· ğŸ“· ì‚¬ì§„: <b>${data.photoCount}ëª…</b> Â· ì´ ì œì¶œ: ${data.totalSubmissions}íšŒ
                ${data.taskNames&&data.taskNames.length?'<br><br><b>ì—…ë¬´ ì™„ë£Œ:</b> <span style="font-size:12px;color:var(--sub);">'+data.taskNames.join(', ')+'</span>':''}
                ${data.photoNames&&data.photoNames.length?'<br><b>ì‚¬ì§„ ì™„ë£Œ:</b> <span style="font-size:12px;color:var(--sub);">'+data.photoNames.join(', ')+'</span>':''}
            </div>`;
            toast('ì„œë²„ í˜„í™© ì¡°íšŒ ì™„ë£Œ!','ok');
        } else {
            const result=Array.isArray(data)?data:(data.result||[data]);
            const prefix=mode==='all'?'ì„œë²„_í†µí•©':mode==='tasks'?'ì„œë²„_ì—…ë¬´':'ì„œë²„_ì‚¬ì§„';
            downloadJSON(result,prefix+'_'+result.length+'ê±´');
            el.innerHTML=`<div style="font-size:12px;color:var(--green);font-weight:600;">âœ… ${result.length}ê±´ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ</div>`;
            toast(`ì„œë²„ ë°ì´í„° ${result.length}ê±´ JSON ë‹¤ìš´ë¡œë“œ!`,'ok');
        }
    }).catch(e=>{toast('ì„œë²„ ì—°ê²° ì‹¤íŒ¨: '+e.message,'err');});
}

// ===== ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ë‹«ê¸° =====
document.getElementById('photoModal').addEventListener('click',function(e){
    if(e.target===this) closePhotoModal();
});

// ===== ê³µí†µ =====
function downloadJSON(data,prefix){
    const b=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(b);
    a.download=prefix+'_'+new Date().toISOString().slice(0,10)+'.json';
    document.body.appendChild(a);a.click();document.body.removeChild(a);
}

function downloadCSV(rows,prefix){
    const BOM='\uFEFF';
    const csv=rows.map(r=>r.map(c=>{
        const s=String(c).replace(/"/g,'""');
        return /[,"\n\r]/.test(s)?`"${s}"`:s;
    }).join(',')).join('\r\n');
    const b=new Blob([BOM+csv],{type:'text/csv;charset=utf-8'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(b);
    a.download=prefix+'_'+new Date().toISOString().slice(0,10)+'.csv';
    document.body.appendChild(a);a.click();document.body.removeChild(a);
}

// ===== ë¹„ë””ì˜¤ í™•ëŒ€ ëª¨ë‹¬ =====
function openVideoModal(){
    const modal=document.getElementById('videoModal');
    const player=document.getElementById('videoModalPlayer');
    modal.classList.add('show');
    player.currentTime=0;
    player.play();
    document.body.style.overflow='hidden';
}
function closeVideoModal(){
    const modal=document.getElementById('videoModal');
    const player=document.getElementById('videoModalPlayer');
    modal.classList.remove('show');
    player.pause();
    document.body.style.overflow='';
}

function toast(m,t){const el=document.getElementById('toast');el.textContent=m;el.className='toast '+(t==='ok'?'ok':t==='err'?'err':'');setTimeout(()=>el.classList.add('show'),10);setTimeout(()=>el.classList.remove('show'),2500);}

// ì´ˆê¸°í™”
initLeadSel();
initPhotoList();
fetchServerStatus(); // ì„œë²„ í˜„í™© ì¡°íšŒ
if(ADMIN_URL){const el=document.getElementById('n8nAdminArea');if(el)el.style.display='block';}
</script>
</body>
</html>
